<div class="flex flex-col relative gap-4 w-full h-[100%]">
  <div class="flex justify-between">
    <div class="flex gap-8 w-[30%]">
      <h1
        (click)="selectControle()"
        class="cursor-pointer text-[2rem] ml-4 font-bold"
        [ngClass]="{ one: control }"
      >
        Controles
      </h1>
      <h1
        (click)="selectArchive()"
        class="cursor-pointer text-[2rem] ml-4 font-bold"
        [ngClass]="{ one: archive }"
      >
        Archives
      </h1>
    </div>

    @if (control) {
    <div class="flex w-[30%] gap-4 mt-4">
      <button
      (click)="exportExcel()"
        class="bg-[#1FA055] cursor-pointer text-lg text-center shadow-md shadow-[#242a30] text-white rounded-lg p-2 font-bold h-10"
      >
        exporter vers excel
      </button>

      <!-- import.component.html -->

      <!-- <button
        type="button"
        (click)="fileInput.click()"
        class="bg-[#1FA055] cursor-pointer text-lg text-center shadow-md shadow-[#242a30] text-white rounded-lg p-2 font-bold h-10"
      >
        Import
      </button> -->
      <input
        #fileInput
        type="file"
        style="display: none"
        (change)="onFileSelected($event)"
      />

      <button
        (click)="openModal()"
        class="bg-[#1FA055] cursor-pointer text-lg text-center shadow-md shadow-[#242a30] text-white rounded-lg p-2 font-bold h-10"
      >
        + controle
      </button>
    </div>
    }
  </div>

  <div class="flex flex-col shadow-sm gap-2 overflow-x-auto h-[91%] p-1">
    <div
      [formGroup]="select"
      class="w-full h-[15%] shadow-md overflow-x-auto rounded gap-10 flex p-1"
    >
      @if (display2) {
      <div class="flex gap-4">
        <label class="text-xl">Pays</label>
        <select
          formControlName="pays_id"
          class="bg-white w-44 outline-none p-1 h-7 ring-1 ring-[#FF7900] rounded-xl shadow-md shadow-[#242a30 flex text-center"
        >
          <option value="0">filtrer par pays</option>
          @for (pays of contries(); track pays.id) {
          <option [value]="pays.id">{{ pays.libelle }}</option>
          }
        </select>
      </div>
      }

      <div class="flex gap-4">
        <label class="text-xl">Type</label>
        <select
          formControlName="type"
          class="bg-white w-44 outline-none p-1 h-7 ring-1 ring-[#FF7900] rounded-xl shadow-md shadow-[#242a30 flex text-center"
        >
          <option value="0">filtrer par type</option>
          @for (type of types(); track type.id) {
          <option [value]="type.id">{{ type.libelle }}</option>
          }
        </select>
      </div>

      @if (display2) {
      <div class="flex gap-4">
        <label class="text-xl">Direction</label>
        <select
          formControlName="direction_id"
          class="bg-white w-44 outline-none p-1 h-7 ring-1 ring-[#FF7900] rounded-xl shadow-md shadow-[#242a30 flex text-center"
        >
          <option value="0">filtrer par direction</option>
          @for (direction of directions(); track direction.id) {
          <option [value]="direction.id">{{ direction.libelle }}</option>
          }
        </select>
      </div>

      <div class="flex gap-4">
        <label class="text-xl">Département</label>
        <select
          formControlName="departement_id"
          class="bg-white outline-none p-1 h-7 ring-1 ring-[#FF7900] rounded-xl shadow-md shadow-[#242a30] w-44 flex text-center"
        >
          <option value="0">filtrer par département</option>
          @for (departement of departements(); track departement.id) {
          <option [value]="departement.id">{{ departement.libelle }}</option>
          }
        </select>
      </div>

      <div class="flex gap-4">
        <label class="text-xl">Pole</label>
        <select
          formControlName="pole_id"
          class="bg-white outline-none p-1 h-7 ring-1 ring-[#FF7900] rounded-xl shadow-md shadow-[#242a30] w-44 flex text-center"
        >
          <option value="0">filtrer par pole</option>
          @for (pole of poles(); track pole.id) {
          <option [value]="pole.id">{{ pole.libelle }}</option>
          }
        </select>
      </div>

      <div class="flex gap-4">
        <label class="text-xl">Service</label>
        <select
          formControlName="service_id"
          class="bg-white outline-none p-1 h-7 ring-1 ring-[#FF7900] rounded-xl shadow-md shadow-[#242a30] w-44 flex text-center"
        >
          <option value="0">filtrer par service</option>
          @for (service of services(); track service.id) {
          <option [value]="service.id">{{ service.libelle }}</option>
          }
        </select>
      </div>

      <div class="flex gap-4">
        <label class="text-xl">Activite</label>
        <select
          formControlName="activite_id"
          class="bg-white outline-none p-1 h-7 ring-1 ring-[#FF7900] rounded-xl shadow-md shadow-[#242a30] w-44 flex text-center"
        >
          <option value="0">filtrer par activité</option>
          @for (activite of activites(); track activite.id) {
          <option [value]="activite.id">{{ activite.libelle }}</option>
          }
        </select>
      </div>
      }

      <div class="flex gap-4">
        <label class="text-xl">Controle</label>
        <select
          formControlName="controle_id"
          class="bg-white outline-none p-1 h-7 ring-1 ring-[#FF7900] rounded-xl shadow-md shadow-[#242a30] w-44 flex text-center"
        >
          <option value="0">filtrer par controle</option>
          @for (controle of controles(); track controle.id) {
          <option [value]="controle.id">{{ controle.nom_controle }}</option>
          }
        </select>
      </div>

      <div class="flex gap-4">
        <label class="text-xl">Risque</label>
        <select
          formControlName="risque_id"
          class="bg-white outline-none p-1 h-7 ring-1 ring-[#FF7900] rounded-xl shadow-md shadow-[#242a30] w-44 flex text-center"
        >
          <option value="0">filtrer par risque</option>
          @for (risque of risques(); track risque.id) {
          <option [value]="risque.id">{{ risque.libelle }}</option>
          }
        </select>
      </div>

      <div class="flex gap-4">
        <label class="text-xl">Couverture</label>
        <select
          formControlName="couverture"
          class="bg-white outline-none p-1 h-7 ring-1 ring-[#FF7900] rounded-xl shadow-md shadow-[#242a30] w-44 flex text-center"
        >
          <option value="0">filtrer par couverture</option>
          <option value="Exhaustivité">Exhaustivité</option>
          <option value="Non exhaustivité">Non exhaustivité</option>
        </select>
      </div>

      @if (display2) {
      <div class="flex gap-4">
        <label class="text-xl">Porteur</label>
        <select
          formControlName="user_id"
          class="bg-white outline-none p-1 h-7 ring-1 ring-[#FF7900] rounded-xl shadow-md shadow-[#242a30] w-44 flex text-center"
        >
          <option value="0">filtrer par porteur</option>
          @for (user of users(); track user.id) {
          <option [value]="user.id">{{ user.nom_complet }}</option>
          }
        </select>
      </div>
      }

      <div class="flex gap-4">
        <label class="text-xl">Periodicite</label>
        <select
          formControlName="periodicite"
          class="bg-white outline-none p-1 h-7 ring-1 ring-[#FF7900] rounded-xl shadow-md shadow-[#242a30] w-44 flex text-center"
        >
          <option value="0">filtrer par periodicite</option>
          <option value="journalière">journalière</option>
          <option value="mensuelle">mensuelle</option>
          <option value="annuelle">annuelle</option>
        </select>
      </div>

      <div class="flex gap-4">
        <label class="text-xl">Statut</label>
        <select
          formControlName="statut"
          class="bg-white outline-none p-1 h-7 ring-1 ring-[#FF7900] rounded-xl shadow-md shadow-[#242a30] w-44 flex text-center"
        >
          <option value="0">filtrer par statut</option>
          <option value="Fait">Fait</option>
          <option value="Non fait">Non fait</option>
          <option value="Applicable">Applicable</option>
          <option value="Non applicable">Non applicable</option>
          <option value="Transferer">Transferer</option>
        </select>
      </div>

      <div class="flex gap-4">
        <label class="text-xl">Etat</label>
        <select
          formControlName="validate"
          class="bg-white outline-none p-1 h-7 ring-1 ring-[#FF7900] rounded-xl shadow-md shadow-[#242a30] w-44 flex text-center"
        >
          <option value="0">filtrer par etat</option>
          <option value="Validé">Validé</option>
          <option value="Non validé">Non validé</option>
        </select>
      </div>

      <div class="flex gap-4">
        <label class="text-xl">Année</label>
        <select
          formControlName="annee"
          class="bg-white outline-none p-1 h-7 ring-1 ring-[#FF7900] rounded-xl shadow-md shadow-[#242a30] w-44 flex text-center"
        >
          <option value="0">filtrer par année</option>
          <option value="2023">2023</option>
          <option value="2024">2024</option>
          <option value="2025">2025</option>
        </select>
      </div>
    </div>

    <div class="container shadow-lg w-full overflow-y-auto h-[100%] p-1">
      <div class="relative shadow-md w-full overflow-y-auto">
        <table class="w-full shadow-lg">
          <thead class="text-white bg-[#FF7900]">
            <tr class="text-lg font-semibold">
              <th>
                <div>Type controle</div>
              </th>
              <th>
                <div>Direction</div>
              </th>
              <th>
                <div>Pole</div>
              </th>
              <th>
                <div>Département</div>
              </th>
              <th>
                <div>Service concerné</div>
              </th>
              <th>
                <div>Activité/Domaine</div>
              </th>
              <th>
                <div>Nom du contrôle</div>
              </th>
              <th>
                <div>Code</div>
              </th>
              <th>
                <div>Descriptif</div>
              </th>
              <th>
                <div>Objectif</div>
              </th>
              <th>
                <div>Risque couvert</div>
              </th>
              <th>
                <div>Porteur</div>
              </th>
              <th>
                <div>Périodicité</div>
              </th>
              <th>
                <div>Couverture</div>
              </th>
              <th>
                <div>Preuve demandée</div>
              </th>
              <!-- <th>
                <div>Fichier preuve</div>
              </th> -->
              <th>
                <div>Commentaire</div>
              </th>
              <th>
                <div>Statut</div>
              </th>
              <th>
                <div>Etat</div>
              </th>
              <th>
                @if (control) {
                <div>Date d'ajout</div>
                } @if (archive) {
                <div>Date d'archive</div>
                }
              </th>
              <th>
                <div>Action</div>
              </th>
            </tr>
          </thead>
          <tbody>
            @if (control) { @for (data of datas() |annee:selectedYear
            |type:selectedType |contry2:selectedContry | direction2:selectedDir
            |periodicite:selectedPrd |statut:selectedStat |validate:selectedVal
            |risque:selectedRisk |controle:selectedCtrl |activite:selectedAct
            |departement2:selectedDept |couverture:selectedCouv
            |porteur:selectedUser |polectrl:selectedPole |service2:selectedServ
            ; track data.id;) {
            <!-- <pre>{{data|json}}</pre> -->
            <tr class="bg-white">
              <td>
                <div>{{ data.type_controle_id.libelle }}</div>
              </td>
              <td>
                <div>{{ data.direction_id.libelle }}</div>
              </td>
              <td>
                <div>{{ data.pole_id.libelle }}</div>
              </td>
              <td>
                <div>{{ data.departement_id.libelle }}</div>
              </td>
              <td>
                <div>{{ data.service_id.libelle }}</div>
              </td>
              <td>
                <div>{{ data.activite_id.libelle }}</div>
              </td>
              <td>
                <div>{{ data.controle }}</div>
              </td>
              <td>
                <div>{{ data.code }}</div>
              </td>
              <td>
                <div>{{ data.descriptif }}</div>
              </td>
              <td>
                <div>{{ data.objectif }}</div>
              </td>
              <td>
                <div>{{ data.risque_id.libelle }}</div>
              </td>
              <td>
                <div>{{ data.user_id.nom_complet }}</div>
              </td>
              <td>
                <div>{{ data.periodicite }}</div>
              </td>
              <td>
                <div>{{ data.exhaustivite }}</div>
              </td>
              <td>
                <div>
                  <textarea readonly>{{ data.preuve }}</textarea>
                </div>
              </td>
              <!-- <td>
                    <div><a target="_blank" [href]="'http://localhost:8000/storage/'+data.fichier"><i class="material-icons">attach_file</i>Fichier Preuve</a></div>
                  </td> -->
              <td>
                <div>
                  <textarea readonly>{{ data.commentaire }}</textarea>
                </div>
              </td>
              <td>
                <div>{{ data.etat }}</div>
              </td>
              <td>
                <div>
                  {{ data.validate }}
                </div>
              </td>
              <td>
                <div>{{ data.date_ajout }}</div>
              </td>
              <td>
                <div class="flex gap-2">
                  <div
                    class="icon-wrapper"
                    (mouseenter)="setHoveredIcon(data.id, 'visibility')"
                    (mouseleave)="clearHoveredIcon(data.id)"
                  >
                    <i
                      (click)="info(data)"
                      class="material-icons cursor-pointer text-gray-600"
                      >visibility</i
                    >
                    <div
                      class="tooltip"
                      *ngIf="hoveredIcon[data.id] === 'visibility'"
                    >
                      voir fiche control
                    </div>
                  </div>
                  <div
                    class="icon-wrapper"
                    (mouseenter)="setHoveredIcon(data.id, 'edit')"
                    (mouseleave)="clearHoveredIcon(data.id)"
                  >
                    <i
                      (click)="editModal(data)"
                      class="material-icons cursor-pointer text-yellow-400"
                      >edit</i
                    >
                    <div
                      class="tooltip"
                      *ngIf="hoveredIcon[data.id] === 'edit'"
                    >
                      editer le control
                    </div>
                  </div>
                  @if (display2 && pays_id== data?.user_id?.pays_id?.id ) {
                  <div
                    class="icon-wrapper"
                    (mouseenter)="setHoveredIcon(data.id, 'archive')"
                    (mouseleave)="clearHoveredIcon(data.id)"
                  >
                    <i
                      (click)="deleteD(data.id)"
                      class="material-icons cursor-pointer text-orange-600"
                      >archive</i
                    >
                    <div
                      class="tooltip"
                      *ngIf="hoveredIcon[data.id] === 'archive'"
                    >
                      Archiver le control
                    </div>
                  </div>
               
                  @if(pays_id== data?.user_id?.pays_id?.id){

                    <div
                      class="icon-wrapper"
                      *ngIf="data.validate === 'Non validé'"
                      (mouseenter)="setHoveredIcon(data.id, 'check_circle')"
                      (mouseleave)="clearHoveredIcon(data.id)"
                    >
                      <i
                        (click)="validate(data.id)"
                        class="material-icons cursor-pointer text-green-600"
                        >check_circle</i
                      >
                      <div
                        class="tooltip"
                        *ngIf="hoveredIcon[data.id] === 'check_circle'"
                      >
                        valider le control
                      </div>
                    </div>
                  }

                  <div
                    class="icon-wrapper"
                    *ngIf="data.validate === 'Validé'"
                    (mouseenter)="setHoveredIcon(data.id, 'cancel')"
                    (mouseleave)="clearHoveredIcon(data.id)"
                  >
                    <i
                      (click)="invalidate(data.id)"
                      class="material-icons cursor-pointer text-red-600"
                      >cancel</i
                    >
                    <div
                      class="tooltip"
                      *ngIf="hoveredIcon[data.id] === 'cancel'"
                    >
                      dévalider le control
                    </div>
                  </div>
                  }
                </div>
              </td>
            </tr>
            } } @if (archive) { @for (data of archives() |
            direction2:selectedDir |periodicite:selectedPrd |statut:selectedStat
            |validate:selectedVal |risque:selectedRisk |controle:selectedCtrl
            |activite:selectedAct |departement2:selectedDept
            |couverture:selectedCouv |porteur:selectedUser
            |polectrl:selectedPole |service2:selectedServ ; track data.id) {
            <tr class="bg-white">
              <td>
                <div>{{ data.type_controle_id.libelle }}</div>
              </td>
              <td>
                <div>{{ data.direction_id.libelle }}</div>
              </td>
              <td>
                <div>{{ data.pole_id.libelle }}</div>
              </td>
              <td>
                <div>{{ data.departement_id.libelle }}</div>
              </td>
              <td>
                <div>{{ data.service_id.libelle }}</div>
              </td>
              <td>
                <div>{{ data.activite_id.libelle }}</div>
              </td>
              <td>
                <div>{{ data.controle }}</div>
              </td>
              <td>
                <div>{{ data.code }}</div>
              </td>
              <td>
                <div>{{ data.descriptif }}</div>
              </td>
              <td>
                <div>{{ data.objectif }}</div>
              </td>
              <td>
                <div>{{ data.risque_id.libelle }}</div>
              </td>
              <td>
                <div>{{ data.user_id.nom_complet }}</div>
              </td>
              <td>
                <div>{{ data.periodicite }}</div>
              </td>
              <td>
                <div>{{ data.exhaustivite }}</div>
              </td>
              <td>
                <div>
                  <textarea readonly>{{ data.preuve }}</textarea>
                </div>
              </td>
              <!-- <td>
                                  <div><a target="_blank" [href]="'http://localhost:8000/storage/'+data.fichier"><i class="material-icons">attach_file</i>Fichier Preuve</a></div>
                                </td> -->
              <td>
                <div>
                  <textarea readonly>{{ data.commentaire }}</textarea>
                </div>
              </td>
              <td>
                <div>{{ data.etat }}</div>
              </td>
              <td>
                <div>
                  {{ data.validate }}
                </div>
              </td>
              <td>
                <div>{{ data.date_ajout }}</div>
              </td>
              <td>
                <div class="flex gap-2">
                  <div
                    class="icon-wrapper"
                    (mouseenter)="setHoveredIcon(data.id, 'visibility')"
                    (mouseleave)="clearHoveredIcon(data.id)"
                  >
                    <i
                      (click)="info(data)"
                      class="material-icons cursor-pointer text-gray-600"
                      >visibility</i
                    >
                    <div
                      class="tooltip"
                      *ngIf="hoveredIcon[data.id] === 'visibility'"
                    >
                      voir fiche control
                    </div>
                  </div>
                  <div
                    class="icon-wrapper"
                    (mouseenter)="setHoveredIcon(data.id, 'archive')"
                    (mouseleave)="clearHoveredIcon(data.id)"
                  >
                    <i
                      (click)="desarchiver(data.id)"
                      class="material-icons cursor-pointer text-orange-600"
                      >unarchive</i
                    >
                    <div
                      class="tooltip"
                      *ngIf="hoveredIcon[data.id] === 'archive'"
                    >
                      Désarchiver le control
                    </div>
                  </div>
                  <!-- <i (click)="desarchiver(data.id)" class="material-icons cursor-pointer text-red-600">archive</i> -->
                </div>
              </td>
            </tr>
            } }
          </tbody>
        </table>
      </div>
    </div>
  </div>
  

  <div
    class="z-50 fixed inset-0 bg-gray-900 bg-opacity-75 flex justify-center items-center"
    style="display: none"
    id="modal"
  >
    <div
      class="mt-20 ml-[24rem] w-[60%] h-[100%] flex flex-col gap-4 rounded-[6px] ring-2 ring-[#242a30]"
    >
      <div class="relative bg-white h-[88%] rounded-lg shadow dark:bg-gray-700">
        <div
          class="flex items-center justify-between p-4 md:p-5 border-b rounded-t bg-[#FF7900]"
        >
          <h3 class="text-2xl font-semibold text-white">
            {{ title }}
          </h3>
          <button
            (click)="closeModal()"
            class="text-white rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center"
            data-modal-toggle="crud-modal"
          >
            <svg
              class="w-3 h-3"
              aria-hidden="true"
              fill="none"
              viewBox="0 0 14 14"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
              />
            </svg>
            <span class="sr-only">Close modal</span>
          </button>
        </div>

        <form
          [formGroup]="Data"
          class="flex flex-col gap-16 p-4 md:p-5 overflow-y-auto h-[87%]"
        >
          <div class="grid gap-4 mb-4 grid-cols-2">
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >Nom controle</label
              >
              <input
                type="text"
                formControlName="controle"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                placeholder="entrer le nom du controle"
              />
              <!-- <select formControlName="controle_id"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                <option value=0>choisir une controle</option>
                @for (ctrl of controles(); track ctrl.id) {
                  <option [value]="ctrl.id">{{ctrl.nom_controle}}</option>
                }
              </select> -->
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >Code</label
              >
              <input
                type="text"
                formControlName="code"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                placeholder="entrer le code du controle"
              />
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >Objectif</label
              >
              <textarea
                formControlName="objectif"
                placeholder="entrer l'objectif du controle"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5"
              ></textarea>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >Descriptif</label
              >
              <textarea
                formControlName="descriptif"
                placeholder="entrer le descriptif du controle"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5"
              ></textarea>
            </div>
            <div class="col-span-2 mt-6 sm:col-span-1">
              <label
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >Type Controle</label
              >
              <select
                formControlName="type"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
              >
                <option value="0">choisir un type de controle</option>
                @for (type of types(); track type.id) {
                <option [value]="type.id">{{ type.libelle }}</option>
                }
              </select>
            </div>
            <div class="col-span-2 mt-6 sm:col-span-1">
              <label
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >Risque</label
              >
              <select
                formControlName="risque_id"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
              >
                <option value="0">choisir un risque</option>
                @for (risque of risques(); track risque.id) {
                <option [value]="risque.id">{{ risque.libelle }}</option>
                }
              </select>
            </div>
            <div class="col-span-2 mt-2 sm:col-span-1">
              <label
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >Porteur</label
              >
              <select
                formControlName="user_id"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
              >
                <option value="0">choisir un porteur</option>
                @for (user of users(); track user.id) {
                <option [value]="user.id">{{ user.nom_complet }}</option>
                }
              </select>
            </div>
            <div class="col-span-2 mt-2 sm:col-span-1">
              <label
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >Direction</label
              >
              <select
                formControlName="direction_id"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
              >
                <option value="0">choisir une direction</option>
                @for (direction of directions(); track direction.id) {
                <option [value]="direction.id">{{ direction.libelle }}</option>
                }
              </select>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >Pole</label
              >
              <select
                formControlName="pole_id"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
              >
                <option value="0">choisir une pole</option>
                @for (pole of poles(); track pole.id) {
                <option [value]="pole.id">{{ pole.libelle }}</option>
                }
              </select>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >Département</label
              >
              <select
                formControlName="departement_id"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
              >
                <option value="0">choisir un département</option>
                @for (departement of departements(); track departement.id) {
                <option [value]="departement.id">
                  {{ departement.libelle }}
                </option>
                }
              </select>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >Service</label
              >
              <select
                formControlName="service_id"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
              >
                <option value="0">choisir une service</option>
                @for (service of services(); track service.id) {
                <option [value]="service.id">{{ service.libelle }}</option>
                }
              </select>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >Activité</label
              >
              <select
                formControlName="activite_id"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
              >
                <option value="0">choisir une activité</option>
                @for (activite of activites(); track activite.id) {
                <option [value]="activite.id">{{ activite.libelle }}</option>
                }
              </select>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >Périodicité</label
              >
              <input
                type="text"
                formControlName="periodicite"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                placeholder="entrer la periodicité"
              />
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >Couverture</label
              >
              <select
                formControlName="exhaustivite"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
              >
                <option value="0">choisir une couverture</option>
                <option value="Exhaustivité">Exhaustivité</option>
                <option value="Non exhaustivité">Non exhaustivité</option>
              </select>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >Preuves demandées</label
              >
              <input
                type="text"
                formControlName="preuve"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                placeholder="saisir la preuve demandée"
              />
            </div>
            <div class="col-span-2 sm:col-span-1">
              @if (display==false) {
              <label
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >Fichiers preuves</label
              >
              <input
                type="file"
                (change)="onFileSelected($event)"
                multiple
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
              />
              } @if (display==true) {
              <div class="file-container">
                <label
                  class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >
                  Fichiers preuves ({{ fileCount }})
                </label>
                <div class="file-grid">
                  <div
                    *ngFor="let file of files; let i = index"
                    class="file-card"
                  >
                    <a target="_blank" [href]="file" class="file-link">
                      fichier {{ i + 1 }}
                    </a>
                  </div>
                </div>
              </div>
              }
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >Etat</label
              >
              <select
                formControlName="etat"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
              >
                <option value="none">choisir un etat</option>
                <option value="Applicable">Applicable</option>
                <option value="Fait">Fait</option>
                <option value="Non fait">Non fait</option>
              </select>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                >Commentaire</label
              >
              <textarea
                formControlName="commentaire"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5"
              ></textarea>
            </div>
          </div>
          <div class="flex">
            <button
              (click)="addOrUp()"
              class="text-white bg-[#FF7900] inline-flex items-center font-medium rounded-lg text-lg px-5 py-2.5 text-center dark:bg-orange-600"
            >
              {{ btn }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
